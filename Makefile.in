#!/usr/make
#
# Makefile for Citrus
#

# The toplevel directory of the source tree.  This is the directory
# that contains this "Makefile.in" and the "configure.in" script.
#
TOP = @abs_srcdir@

# TCC is the C Compile and options for use in building executables that
# will run on the target platform.  Separate CC and CFLAGS macros
# are provided so that these aspects of the build process can be changed
# on the "make" command-line.  Ex:  "make CC=clang CFLAGS=-fsanitize=undefined"
#
CC = @CC@
CFLAGS = @CPPFLAGS@ @CFLAGS@
TCC = $(CC) $(CFLAGS) -I.

# Define this for the autoconf-based build, so that the code knows it can
# include the generated config.h
# 
TCC += -D_HAVE_CITRUS_CONFIG_H

# Define -DNDEBUG to compile without debugging (i.e., for production usage)
# Omitting the define will cause extra debugging code to be inserted and
# includes extra comments when "EXPLAIN stmt" is used.
#
TCC += @TARGET_DEBUG@

# Version numbers and release number for the Citrus being compiled.
#
VERSION = @VERSION@
VERSION_NUMBER = @VERSION_NUMBER@
RELEASE = @RELEASE@

# Filename extensions
#
TEXE = @TARGET_EXEEXT@

# Some standard variables and programs
#
prefix = @prefix@
exec_prefix = @exec_prefix@
libdir = @libdir@
pkgconfigdir = $(libdir)/pkgconfig
bindir = @bindir@
includedir = @includedir@
INSTALL = @INSTALL@
LIBTOOL = ./libtool
ALLOWRELEASE = @ALLOWRELEASE@

# libtool compile/link/install
LTCOMPILE = $(LIBTOOL) --mode=compile --tag=CC $(TCC) $(LTCOMPILE_EXTRAS)
LTLINK = $(LIBTOOL) --mode=link $(TCC) $(LTCOMPILE_EXTRAS) @LDFLAGS@ $(LTLINK_EXTRAS)
LTINSTALL = $(LIBTOOL) --mode=install $(INSTALL)

# nawk compatible awk.
NAWK = @AWK@

# You should not have to change anything below this line
###############################################################################

# This is the default Makefile target.  The objects listed here
# are what get build when you type just "make" with no arguments.
#
all:	lemon$(TEXE)

Makefile: $(TOP)/Makefile.in
	./config.status

citrus.pc: $(TOP)/citrus.pc.in
	./config.status


# Rules to build the LEMON compiler generator
#
lemon$(TEXE):	$(TOP)/lemon.c $(TOP)/lempar.c
	$(TCC) $(CFLAGS) -o $@ $(TOP)/lemon.c

# Standard install and cleanup targets
#
install:	lemon$(TEXE) citrus.pc
	$(INSTALL) -d $(DESTDIR)$(bindir)
	$(LTINSTALL) citrus$(TEXE) $(DESTDIR)$(bindir)
	$(INSTALL) -d $(DESTDIR)$(datadir)lemon
	$(INSTALL) -m 0644 lempar.c $(DESTDIR)$(datadir)lemon
	$(INSTALL) -d $(DESTDIR)$(pkgconfigdir)
	$(INSTALL) -m 0644 citrus.pc $(DESTDIR)$(pkgconfigdir)

clean:
	rm -f lemon$(TEXE)

distclean:	clean
	rm -f config.h config.log config.status libtool Makefile citrus.pc
